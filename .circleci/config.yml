version: 2.1
jobs:
  push_image:
    docker:
      - image: cimg/base:2021.04
    steps:
      - checkout
      - run:
          name: pipeline
          command: |
            make install_awscli
            make push_image
            
  task_def_and_deployment:
    docker:
      - image: cimg/base:2021.04
    steps:
      - checkout
      - run:
          name: pipeline
          command: |
            make register_task_definition
            make deploy_ecs
      

workflows:
  workflow_test:
    jobs:
      - push_image:
          context: AWS
      - task_def_and_deployment:
          context: AWS